JAVAC = @JAVAC@
ANDROID = @ANDROID@
ANDROID_SDK_PATH = @ANDROID_SDK_PATH@
PROJECT_NAME = @PACKAGE_NAME@
DX = @DX@

srcdir = @srcdir@
top_srcdir = @top_srcdir@
prefix = @prefix@

RDNS = "com/qdii/$(PROJECT_NAME)"
RRDNS = $(srcdir)/src/$(RDNS)
OBJ = "."
LIB = $(srcdir)/libs
TARGET_ID = @TATOPARSER_TARGET_ID@
TARGET_VM = 1.6
TARGET_VM_SOURCE = 1.6

ANDROID_CLASSPATH = $(ANDROID_SDK_PATH)/platforms/$(TARGET_ID)/android.jar
ANDROID_FLAGS = -classpath "$(ANDROID_CLASSPATH):$(OBJ)" -sourcepath $(srcdir) -d $(OBJ) -target $(TARGET_VM) -source $(TARGET_VM_SOURCE)

all: update-project compile-r-file $(OBJ_FILES) dexify

update-project:
	$(ANDROID) update project --no-ui --name "$(PROJECT_NAME)" --target "$(TARGET_ID)" --path $(srcdir)

%.class:
	$(JAVAC) $(ANDROID_FLAGS) $*.java

SOURCE_FILES = $(RRDNS)/ActivitySearch.java	$(RRDNS)/Sentence.java

OBJ_FILES = $(SOURCE_FILES:.java=.class)

compile-r-file: $(srcdir)/gen/$(RDNS)/R.class	$(srcdir)/gen/$(RDNS)/BuildConfig.class

dexify:
	$(DX) --dex --output=$(OBJ)/classes.dex $(OBJ) $(LIB)

clean:
	$(RM) -f $(OBJ)/*.class
